(()=>{"use strict";$.when($.ready,mw.loader.using(["mediawiki.api","ext.gadget.libOOUIDialog"])).then(()=>{if("Contributions"!==mw.config.get("wgCanonicalSpecialPageName"))return;$(".mw-contributions-list li").each(function(){const t=document.createElement("input");t.setAttribute("type","checkbox"),t.setAttribute("data-title",this.getElementsByClassName("mw-contributions-title")[0].innerText),t.setAttribute("data-revid",this.getAttribute("data-mw-revid")),this.prepend(t)});const t=$("<div>",{id:"mw-history-revision-actions"}).css({float:"right","margin-bottom":"1em"});t.append(...[{label:"全选/反选",id:"mw-checkbox-invert"},{label:"连选",id:"mw-checkbox-between",title:"请勾选需要操作的第一个和最后一个复选框后点击此按钮。"},{label:"撤销",id:"contributions-undo-button",classes:["mw-ui-progressive"]},{label:"回退",id:"contributions-rollback-button",classes:["mw-ui-progressive","patroller-show"],title:"默认不启用markbotedit权限。"},{label:"挂删",id:"contributions-registerdelete-button",classes:["mw-ui-progressive","patroller-show"]},{label:"版本删除",id:"contributions-revdel-button",classes:["mw-ui-progressive","sysop-show"],title:"默认仅删除内容和摘要。"}].map(t=>new OO.ui.ButtonWidget(t).$element)),$("div.mw-htmlform-ooui-wrapper.oo-ui-layout.oo-ui-panelLayout.oo-ui-panelLayout-padded.oo-ui-panelLayout-framed").after(t),$("#mw-checkbox-invert").click(()=>{$('li input[type="checkbox"]').prop("checked",(t,e)=>!e)}),$("#mw-checkbox-between").click(()=>{const t=$('.mw-contributions-list input[type="checkbox"]:checked:last').parent()[0];$('.mw-contributions-list input[type="checkbox"]:checked:first').parent().nextUntil(t).children('input[type="checkbox"]').prop("checked",!0)});const e=new mw.Api;$("#contributions-rollback-button").click(async()=>{const t=$(".mw-contributions-list li :checkbox:checked"),o=await oouiDialog.prompt(`<ul><li>选中了${t.length}个页面</li><li>批量回退操作的编辑摘要：<code>xxx// MassRollback</code></li><li>空白则使用默认回退摘要，取消则不进行回退</li><li>管理员可自授权机器用户或在URL后添加<code>bot=1</code>以启用markbotedit。</li></ul><hr>请输入回退摘要：`,{title:"批量回退小工具",size:"medium",required:!1});if(null===o)return;console.log("开始回退...");const i=mw.config.get("wgRelevantUserName");t.each(function(){const t=this.getAttribute("data-title");try{e.postWithToken("rollback",{action:"rollback",format:"json",title:t,user:i,markbot:mw.config.get("wgUserGroups").includes("sysop")&&(mw.config.get("wgUserGroups").includes("flood")||document.URL.includes("bot=1")),watchlist:"nochange",tags:"Automation tool",summary:o?`${o} // MassRollback`:"// MassRollback"}).then(e=>{console.log(`回退：${t}\n${e}`)})}catch(t){console.log(`回退失败：${t}`instanceof Error?t.stack.split("\n")[1].trim():JSON.stringify(t))}})}),$("#contributions-undo-button").click(async()=>{const t=$(".mw-contributions-list li :checkbox:checked"),o=await oouiDialog.prompt(`<ul><li>选中了${t.length}个页面</li><li>批量撤销操作的编辑摘要：<code>xxx// MassUndo</code></li><li>空白则使用默认撤销摘要，取消则不进行撤销</li></ul><hr>请输入撤销摘要：`,{title:"批量撤销小工具",size:"medium",required:!1});null!==o&&(console.log("开始撤销..."),t.each(function(){const t=this.getAttribute("data-title"),i=this.getAttribute("data-revid");try{e.postWithToken("csrf",{action:"edit",format:"json",title:t,undo:i,tags:"Automation tool",bot:mw.config.get("wgUserGroups").includes("flood"),watchlist:"nochange",summary:o?`${o} // MassUndo`:"// MassUndo"}).then(e=>{console.log(`撤销：${t}\n${e}`)})}catch(t){console.log(`撤销失败：${t}`instanceof Error?t.stack.split("\n")[1].trim():JSON.stringify(t))}}))}),$("#contributions-registerdelete-button").click(async()=>{const t=$(".mw-contributions-list li :checkbox:checked"),o=mw.config.get("wgUserName"),i=await oouiDialog.prompt(`<ul><li>选中了${t.length}个页面</li><li>批量挂删操作的编辑摘要：<code>xxx// MassDelete</code></li><li>空白则使用默认摘要，取消则不进行挂删</li></ul><hr>请输入挂删摘要：`,{title:"批量挂删小工具",size:"medium",required:!1});null!==i&&(console.log("开始挂删..."),t.each(function(){const t=this.getAttribute("data-title");try{e.postWithToken("csrf",{action:"edit",format:"json",title:t,text:`<noinclude>{{即将删除|user=${o}|1=${i}}}</noinclude>`,tags:"Automation tool",bot:mw.config.get("wgUserGroups").includes("flood"),watchlist:"nochange",summary:i?`${i} // MassDelete`:"// MassDelete"}).then(e=>{console.log(`挂删：${t}\n${e}`)})}catch(t){console.log(`挂删失败：${t}`instanceof Error?t.stack.split("\n")[1].trim():JSON.stringify(t))}}))}),$("#contributions-revdel-button").click(async()=>{const t=$(".mw-contributions-list li :checkbox:checked"),o=await oouiDialog.prompt(`<ul><li>选中了${t.length}个页面，将删除版本内容和编辑摘要</li><li>批量版本删除的原因：<code>xxx// MassRevisionDelete</code></li><li>空白则使用默认原因，取消则不进行版本删除</li></ul><hr>请输入版本删除原因：`,{title:"批量版本删除小工具",size:"medium",required:!1});null!==o&&(console.log("开始版本删除..."),t.each(function(){const t=this.getAttribute("data-title"),i=this.getAttribute("data-revid");try{e.postWithToken("csrf",{action:"revisiondelete",format:"json",type:"revision",target:t,ids:i,tags:"Automation tool",hide:"comment|content",reason:o?`${o} // MassRevisionDelete`:"// MassRevisionDelete"}).then(e=>{console.log(`版本删除：${t}\n${e}`)})}catch(t){console.log(`版本删除失败：${t}`instanceof Error?t.stack.split("\n")[1].trim():JSON.stringify(t))}}))})})})();
//# sourceMappingURL=MassRollback.min.js.map