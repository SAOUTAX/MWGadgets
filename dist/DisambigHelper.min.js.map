{"version":3,"file":"DisambigHelper.min.js","mappings":"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","sources":["webpack://mwgadgets/./src/DisambigHelper/index.js"],"sourcesContent":["$(function () {\r\n\r\n  if (!mw.config.get( 'wgIsArticle' ) || mw.config.get( 'wgPageContentModel' ) !== 'wikitext') { return }\r\n\r\n  const msg = {\r\n    loading: '加载中...',\r\n    loadingFailed: '( ﾟ∀。)加载失败',\r\n    editing: '修改中...',\r\n    edited: '修改成功！正在刷新页面...',\r\n    editFailed: '( ﾟ∀。)修改失败',\r\n    disambig: '消歧义',\r\n  }\r\n  switch (mw.config.get().wgUserLanguage) {\r\n    case 'zh-hant':\r\n      msg.loading = '加載中...';\r\n      msg.loadingFailed = '( ﾟ∀。)加載失敗';\r\n      msg.editing = '修改中...';\r\n      msg.edited = '修改成功！正在刷新頁面...';\r\n      msg.editFailed = '( ﾟ∀。)修改失敗';\r\n      msg.disambig = '消歧義';\r\n      break;\r\n  }\r\n\r\n  const edit = `<img class=\"icon\" alt=\"edit\" src=\"data:image/svg+xml;base64,PHN2ZyB0PSIxNjMyMTExNDY4NTg2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzNTciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNODI3LjczMzMzMyAzMTMuMTczMzMzTDcxMC44MjY2NjcgMTk2LjI2NjY2N0E4NS4zMzMzMzMgODUuMzMzMzMzIDAgMCAwIDU5Ny4zMzMzMzMgMTkzLjI4bC0zODQgMzg0YTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDAtMjQuMzIgNTEuNjI2NjY3TDE3MC42NjY2NjcgODA2LjgyNjY2N2E0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDEyLjM3MzMzMyAzNC4xMzMzMzNBNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMCAyMTMuMzMzMzMzIDg1My4zMzMzMzNoMy44NGwxNzcuOTItMTYuMjEzMzMzYTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDAgNTEuNjI2NjY3LTI0LjMybDM4NC0zODRhODEuOTIgODEuOTIgMCAwIDAtMi45ODY2NjctMTE1LjYyNjY2N3pNNjgyLjY2NjY2NyA0NTUuNjhMNTY4LjMyIDM0MS4zMzMzMzNsODMuMi04NS4zMzMzMzNMNzY4IDM3Mi40OHoiIHAtaWQ9IjMzNTgiPjwvcGF0aD48L3N2Zz4=\">`;\r\n  const edit_all = `<img class=\"icon\" alt=\"edit_all\" src=\"data:image/svg+xml;base64,PHN2ZyB0PSIxNjMyMTExNDY4NTg2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzNTciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNODI3LjczMzMzMyAzMTMuMTczMzMzTDcxMC44MjY2NjcgMTk2LjI2NjY2N0E4NS4zMzMzMzMgODUuMzMzMzMzIDAgMCAwIDU5Ny4zMzMzMzMgMTkzLjI4bC0zODQgMzg0YTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDAtMjQuMzIgNTEuNjI2NjY3TDE3MC42NjY2NjcgODA2LjgyNjY2N2E0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDEyLjM3MzMzMyAzNC4xMzMzMzNBNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMCAyMTMuMzMzMzMzIDg1My4zMzMzMzNoMy44NGwxNzcuOTItMTYuMjEzMzMzYTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDAgNTEuNjI2NjY3LTI0LjMybDM4NC0zODRhODEuOTIgODEuOTIgMCAwIDAtMi45ODY2NjctMTE1LjYyNjY2N3pNNjgyLjY2NjY2NyA0NTUuNjhMNTY4LjMyIDM0MS4zMzMzMzNsODMuMi04NS4zMzMzMzNMNzY4IDM3Mi40OHoiIHAtaWQ9IjMzNTgiIGZpbGw9IiNkODFlMDYiPjwvcGF0aD48L3N2Zz4=\">`;\r\n  const link = `<img class=\"icon\" alt=\"link\" src=\"data:image/svg+xml;base64,PHN2ZyB0PSIxNjMyMTExNzE4MDc5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM1NjgiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNMzQxLjMzMzMzMyA1MTJhNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMCA0Mi42NjY2NjcgNDIuNjY2NjY3aDI1NmE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDAtODUuMzMzMzM0SDM4NGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwLTQyLjY2NjY2NyA0Mi42NjY2Njd6IiBwLWlkPSIzNTY5Ij48L3BhdGg+PHBhdGggZD0iTTM4NCA2ODIuNjY2NjY3SDMwNy42MjY2NjdBMTc2LjIxMzMzMyAxNzYuMjEzMzMzIDAgMCAxIDEyOCA1MjcuNzg2NjY3IDE3MC42NjY2NjcgMTcwLjY2NjY2NyAwIDAgMSAyOTguNjY2NjY3IDM0MS4zMzMzMzNoODUuMzMzMzMzYTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDAgMC04NS4zMzMzMzNIMzA3LjYyNjY2N2EyNjIuNCAyNjIuNCAwIDAgMC0yNjIuODI2NjY3IDIyMi4yOTMzMzNBMjU2IDI1NiAwIDAgMCAyOTguNjY2NjY3IDc2OGg4NS4zMzMzMzNhNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMCAwLTg1LjMzMzMzM3pNOTgxLjMzMzMzMyA0NzkuNTczMzMzQTI2Mi44MjY2NjcgMjYyLjgyNjY2NyAwIDAgMCA3MTUuMDkzMzMzIDI1NmgtNjQuNDI2NjY2QzYxNi4xMDY2NjcgMjU2IDU5Ny4zMzMzMzMgMjc1LjIgNTk3LjMzMzMzMyAyOTguNjY2NjY3YTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDAgNDIuNjY2NjY3IDQyLjY2NjY2Nmg3Ni4zNzMzMzNBMTc2LjIxMzMzMyAxNzYuMjEzMzMzIDAgMCAxIDg5NiA0OTYuMjEzMzMzIDE3MC42NjY2NjcgMTcwLjY2NjY2NyAwIDAgMSA3MjUuMzMzMzMzIDY4Mi42NjY2NjdoLTg1LjMzMzMzM2E0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDAgODUuMzMzMzMzaDg1LjMzMzMzM2EyNTYgMjU2IDAgMCAwIDI1Ni0yODguNDI2NjY3eiIgcC1pZD0iMzU3MCI+PC9wYXRoPjwvc3ZnPg==\">`;\r\n\r\n  const style = `<style>\r\n    a.mw-disambig.mw-disambig { color: #ff8921; }\r\n    a.mw-disambig.mw-disambig:visited { color: #d2711b; }\r\n    a.mw-redirect.mw-disambig { color: #ff6421; }\r\n    a.mw-redirect.mw-disambig:visited { color: #d2521b; }\r\n    div.disambig-box {\r\n      width: 200px;\r\n      max-height: 220px;\r\n      overflow-y: scroll;\r\n      border-radius: 2px;\r\n      box-shadow: rgba(0, 0, 0, 0.156863) 0px 3px 10px, rgba(0, 0, 0, 0.227451) 0px 3px 10px;\r\n      -webkit-box-shadow: rgba(0, 0, 0, 0.156863) 0px 3px 10px, rgba(0, 0, 0, 0.227451) 0px 3px 10px;\r\n      margin: 0;\r\n      padding: 0;\r\n      color: #000;\r\n      background: #FFF;\r\n      position: absolute;\r\n      font-size: 14px;\r\n      font-style: normal;\r\n      font-weight: normal;\r\n      text-decoration: none;\r\n      text-align: left;\r\n      display: none;\r\n      transition: all 500ms cubic-bezier(.23, 1, .32, 1) 0ms;\r\n      z-index: 999;\r\n    }\r\n    .disambig-box ul.disambig-ul {\r\n      list-style: none;\r\n      padding: 0 !important;\r\n      margin: 0 !important;\r\n    }\r\n    .disambig-box li {\r\n      color: #000 !important;\r\n      padding: 2px 10px;\r\n      transition: all 500ms cubic-bezier(.23, 1, .32, 1) 0ms;\r\n    }\r\n    .disambig-box li:hover { background: #F0F0F0; }\r\n    .disambig-box li a { text-decoration: none; }\r\n    .icon {\r\n      margin-left: 5px;\r\n      width: 20px;\r\n      opacity: .7;\r\n      transition: all 500ms cubic-bezier(.23, 1, .32, 1) 0ms;\r\n    }\r\n    .icon:hover { opacity: 1; }\r\n    </style>`;\r\n  $('body').append(style);\r\n\r\n  const getLinkTitle = element => decodeURI($(element).attr('href').substring(1)).replace('%2F', '/')\r\n\r\n  const getWikitext = title => {\r\n    return new Promise(resolve => {\r\n      new mw.Api().get({\r\n        action: 'parse',\r\n        page: title,\r\n        redirects: true,\r\n        prop: 'wikitext',\r\n        format: 'json',\r\n      }).done((data) => {\r\n        resolve(data.parse.wikitext['*']);\r\n      }).fail((a, b, errorThrown) => {\r\n        resolve(errorThrown);\r\n      });\r\n    })\r\n  }\r\n\r\n  const repeat_num_list = function() {\r\n    let list = {}\r\n    $('.mw-disambig').each(function() {\r\n      const title = getLinkTitle(this);\r\n      list[title] = list[title] + 1 || 0;\r\n    });\r\n    return list\r\n  }();\r\n\r\n  $('.mw-disambig').each(async function() {\r\n\r\n    const title = getLinkTitle(this); // 链接页面标题\r\n    const display_title = $(this).text(); // 管道符后显示文字\r\n    let id_title = title.split('.').join(''); // 防止消歧义页标题含 .\r\n    let repeat_now = $(`#${id_title}`).length;\r\n    if (repeat_now > 0) { id_title = id_title + repeat_now + 1; } // 同页面出现相同的消歧义链接\r\n    const edit_icon = repeat_num_list[title] === 0 ? edit : edit_all;\r\n    const send = msg => { $(`#${id_title} ul`).empty().append(`<li>${msg}</li>`) }\r\n\r\n    $(this).after(\r\n      $('<div>', {\r\n        id: id_title,\r\n        class: 'disambig-box',\r\n      }).on('mouseleave', () => {\r\n        $(`#${id_title}`).hide(150, 'swing');\r\n      }).append('<ul class=\"disambig-ul\">'),\r\n      $('<sup>').append($('<a>', {\r\n        href: 'javascript:void(0)',\r\n        text: '?',\r\n        class: id_title,\r\n      }))\r\n    )\r\n\r\n    $(`a.${id_title}`).on('mouseenter', async () => {\r\n      $(`#${id_title}`).css({ // 定位\r\n        'left': $(this).position()['left'] + 10,\r\n        'top': $(this).position()['top'] + 16,\r\n      });\r\n      send(msg.loading);\r\n      $(`#${id_title}`).show(150, 'swing');\r\n\r\n      let senses = await getWikitext(title); // 获取义项\r\n      senses = senses.split('\\n').map(\r\n        sense => sense.substring(0, sense.indexOf('——'))\r\n      ).map(sense => {\r\n        if (sense.match(/\\[\\[/g) && !sense.match(/\\[\\[File:/gi)) {\r\n          return sense.split('[[')[1].split(']]')[0]\r\n        } else if (sense.match(/\\{\\{(dis|dl)\\|/gi)) { // {{dis}}, {{dl}}\r\n          return sense.split(/\\{\\{(dis|dl)\\|/gi)[1]\r\n        } else if (sense.match(/\\{\\{coloredlink\\|/gi)) { // {{coloredlink}}\r\n          return sense.split(/\\{\\{coloredlink\\|/gi)[1]\r\n        }\r\n      }).filter(sense => sense).map(sense => sense.split('|')[0]);\r\n\r\n      $(`#${id_title} ul`).empty();\r\n      if (!senses[0]) { return send(msg.loadingFailed) }\r\n      for (const sense of senses) {\r\n        let safe_sense = sense.replace('\"', '&quot;');\r\n        $(`#${id_title} ul`).append(`<li id=\"${safe_sense}\">${sense}<a href=\"/${safe_sense}\">${link}</a><a>${edit_icon}</a></li>`);\r\n        document.getElementById(sense).lastChild.addEventListener('click', async () => {\r\n          send(msg.editing);\r\n          let page_title = mw.config.get().wgPageName;\r\n          let wikitext = await getWikitext(page_title);\r\n          let origin_link = `[[${title}]]`;\r\n          if (title !== display_title) {\r\n            origin_link = `[[${title}|${display_title}]]`;\r\n          }\r\n          new mw.Api().postWithToken('csrf', {\r\n            action: 'edit',\r\n            text: wikitext.replaceAll(origin_link, `[[${sense}|${display_title}]]`),\r\n            title: page_title,\r\n            minor: true,\r\n            nocreate: true,\r\n            summary: `${msg.disambig}：[[${title}]]→[[${sense}]]`,\r\n            tags: \"Automation tool\",\r\n            errorformat: 'plaintext'\r\n          }).done((data) => {\r\n            send(msg.edited);\r\n            window.location.reload();\r\n          }).fail((a, b, errorThrown) => {\r\n            send(`${msg.editFailed}（${errorThrown}）`);\r\n          });\r\n        });\r\n      }\r\n    })\r\n\r\n  })\r\n\r\n});"],"names":["$","mw","config","get","msg","loading","loadingFailed","editing","edited","editFailed","disambig","wgUserLanguage","append","getLinkTitle","element","decodeURI","attr","substring","replace","getWikitext","title","Promise","resolve","Api","action","page","redirects","prop","format","done","data","parse","wikitext","fail","a","b","errorThrown","repeat_num_list","list","each","this","async","display_title","text","id_title","split","join","repeat_now","length","edit_icon","send","empty","after","id","class","on","hide","href","css","position","show","senses","map","sense","indexOf","match","filter","safe_sense","document","getElementById","lastChild","addEventListener","page_title","wgPageName","origin_link","postWithToken","replaceAll","minor","nocreate","summary","tags","errorformat","window","location","reload"],"sourceRoot":""}