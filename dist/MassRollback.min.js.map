{"version":3,"file":"MassRollback.min.js","mappings":"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","sources":["webpack://mwgadgets/./src/MassRollback/index.js"],"sourcesContent":["/* TODO:\r\n    1.回退/撤销失败的页面给出控制台以外的提示\r\n    2.为管理员回退提供markbot可选框，无需以flood用户组或URL带bot视为开关\r\n    3.可能不需要连选功能，按住shift可自动连选，但移动设备无shift\r\n    4.使用ooui\r\n*/\r\n\"use strict\";\r\n$.when($.ready, mw.loader.using([\"mediawiki.api\", \"ext.gadget.libOOUIDialog\"])).then(() => {\r\n    if (mw.config.get(\"wgCanonicalSpecialPageName\") !== \"Contributions\") {\r\n        return;\r\n    }\r\n\r\n    $(\".mw-contributions-list li\").each(function () {\r\n        const newChk = document.createElement(\"input\");\r\n        newChk.setAttribute(\"type\", \"checkbox\");\r\n        newChk.setAttribute(\"data-title\", this.getElementsByClassName(\"mw-contributions-title\")[0].innerText);\r\n        newChk.setAttribute(\"data-revid\", this.getAttribute(\"data-mw-revid\"));\r\n        this.prepend(newChk);\r\n    });\r\n\r\n    const $actionsDiv = $('<div>', { id: 'mw-history-revision-actions' }).css({ float: 'right', 'margin-bottom': '1em' });\r\n\r\n    const buttonsConfig = [\r\n        { label: '全选/反选', id: 'mw-checkbox-invert' },\r\n        { label: '连选', id: 'mw-checkbox-between', title: '请勾选需要操作的第一个和最后一个复选框后点击此按钮。' },\r\n        { label: '撤销', id: 'contributions-undo-button', classes: ['mw-ui-progressive'] },\r\n        { label: '回退', id: 'contributions-rollback-button', classes: ['mw-ui-progressive', 'patroller-show'], title: '默认不启用markbotedit权限。' },\r\n        { label: '挂删', id: 'contributions-registerdelete-button', classes: ['mw-ui-progressive', 'patroller-show'] },\r\n        { label: '版本删除', id: 'contributions-revdel-button', classes: ['mw-ui-progressive', 'sysop-show'], title: '默认仅删除内容和摘要。' }\r\n    ];\r\n    $actionsDiv.append(\r\n        ...buttonsConfig.map(cfg => new OO.ui.ButtonWidget(cfg).$element)\r\n    );\r\n\r\n    $('div.mw-htmlform-ooui-wrapper.oo-ui-layout.oo-ui-panelLayout.oo-ui-panelLayout-padded.oo-ui-panelLayout-framed').after($actionsDiv);\r\n\r\n    $(\"#mw-checkbox-invert\").click(() => {\r\n        $(\"li input[type=\\\"checkbox\\\"]\").prop(\"checked\", (_i, ele) => !ele);\r\n    });\r\n    $(\"#mw-checkbox-between\").click(() => {\r\n        const last = $(\".mw-contributions-list input[type=\\\"checkbox\\\"]:checked:last\").parent()[0];\r\n        $(\".mw-contributions-list input[type=\\\"checkbox\\\"]:checked:first\").parent().nextUntil(last).children(\"input[type=\\\"checkbox\\\"]\").prop(\"checked\", true);\r\n    });\r\n\r\n    const api = new mw.Api();\r\n\r\n    $(\"#contributions-rollback-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面</li><li>批量回退操作的编辑摘要：<code>xxx// MassRollback</code></li><li>空白则使用默认回退摘要，取消则不进行回退</li><li>管理员可自授权机器用户或在URL后添加<code>bot=1</code>以启用markbotedit。</li></ul><hr>请输入回退摘要：`, {\r\n            title: \"批量回退小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始回退...\");\r\n        const user = mw.config.get(\"wgRelevantUserName\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\");\r\n            try {\r\n                api.postWithToken(\"rollback\", {\r\n                    action: \"rollback\",\r\n                    format: \"json\",\r\n                    title: title,\r\n                    user: user,\r\n                    markbot: mw.config.get(\"wgUserGroups\").includes(\"sysop\") && (mw.config.get(\"wgUserGroups\").includes(\"flood\") || document.URL.includes(\"bot=1\")),\r\n                    watchlist: \"nochange\",\r\n                    tags: \"Automation tool\",\r\n                    summary: reason ? `${reason} // MassRollback` : \"// MassRollback\",\r\n                }).then((result) => {\r\n                    console.log(`回退：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`回退失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n\r\n    $(\"#contributions-undo-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面</li><li>批量撤销操作的编辑摘要：<code>xxx// MassUndo</code></li><li>空白则使用默认撤销摘要，取消则不进行撤销</li></ul><hr>请输入撤销摘要：`, {\r\n            title: \"批量撤销小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始撤销...\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\"),\r\n                revid = this.getAttribute(\"data-revid\");\r\n            try {\r\n                api.postWithToken(\"csrf\", {\r\n                    action: \"edit\",\r\n                    format: \"json\",\r\n                    title: title,\r\n                    undo: revid,\r\n                    tags: \"Automation tool\",\r\n                    bot: mw.config.get(\"wgUserGroups\").includes(\"flood\"),\r\n                    watchlist: \"nochange\",\r\n                    summary: reason ? `${reason} // MassUndo` : \"// MassUndo\",\r\n                }).then((result) => {\r\n                    console.log(`撤销：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`撤销失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n\r\n    $(\"#contributions-registerdelete-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const username = mw.config.get(\"wgUserName\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面</li><li>批量挂删操作的编辑摘要：<code>xxx// MassDelete</code></li><li>空白则使用默认摘要，取消则不进行挂删</li></ul><hr>请输入挂删摘要：`, {\r\n            title: \"批量挂删小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始挂删...\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\");\r\n            try {\r\n                api.postWithToken(\"csrf\", {\r\n                    action: \"edit\",\r\n                    format: \"json\",\r\n                    title: title,\r\n                    text: `<noinclude>{{即将删除|user=${username}|1=${reason}}}</noinclude>`,\r\n                    tags: \"Automation tool\",\r\n                    bot: mw.config.get(\"wgUserGroups\").includes(\"flood\"),\r\n                    watchlist: \"nochange\",\r\n                    summary: reason ? `${reason} // MassDelete` : \"// MassDelete\",\r\n                }).then((result) => {\r\n                    console.log(`挂删：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`挂删失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n\r\n    $(\"#contributions-revdel-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面，将删除版本内容和编辑摘要</li><li>批量版本删除的原因：<code>xxx// MassRevisionDelete</code></li><li>空白则使用默认原因，取消则不进行版本删除</li></ul><hr>请输入版本删除原因：`, {\r\n            title: \"批量版本删除小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始版本删除...\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\"),\r\n                revid = this.getAttribute(\"data-revid\");\r\n            try {\r\n                api.postWithToken(\"csrf\", {\r\n                    action: \"revisiondelete\",\r\n                    format: \"json\",\r\n                    type: \"revision\",\r\n                    target: title,\r\n                    ids: revid,\r\n                    tags: \"Automation tool\",\r\n                    hide: \"comment|content\",\r\n                    reason: reason ? `${reason} // MassRevisionDelete` : \"// MassRevisionDelete\",\r\n                }).then((result) => {\r\n                    console.log(`版本删除：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`版本删除失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n});"],"names":["_regenerator","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","toString","slice","constructor","name","test","_unsupportedIterableToArray","_nonIterableSpread","$","when","ready","mw","loader","using","config","get","each","newChk","document","createElement","setAttribute","this","getElementsByClassName","innerText","getAttribute","prepend","$actionsDiv","id","css","float","append","label","title","classes","map","cfg","OO","ui","ButtonWidget","$element","after","click","prop","_i","ele","last","parent","nextUntil","children","api","Api","_callee","checked","reason","user","_context","oouiDialog","prompt","concat","size","required","console","log","postWithToken","action","format","markbot","includes","URL","watchlist","tags","summary","result","Error","stack","split","trim","JSON","stringify","_callee2","_context2","revid","undo","bot","_callee3","username","_context3","text","_callee4","_context4","type","target","ids","hide"],"sourceRoot":""}